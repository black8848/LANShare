<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>内网传输</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .grid-layout {
            display: grid;
            gap: 20px;
        }

        @media (min-width: 1024px) {
            .grid-layout {
                grid-template-columns: 1fr 1fr;
            }
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        h1 svg {
            width: 32px;
            height: 32px;
            color: #4a90d9;
        }

        .title-text {
            background: linear-gradient(135deg, #4a90d9, #67b26f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .card h2 {
            font-size: 16px;
            color: #666;
            margin-bottom: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: #e5e5e5;
            color: #666;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 500;
        }

        /* 批量操作 */
        .batch-bar {
            display: none;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: #f0f7ff;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .batch-bar.show {
            display: flex;
        }

        .batch-bar span {
            flex: 1;
            font-size: 14px;
            color: #4a90d9;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #4a90d9;
        }

        /* 上传区域 */
        .upload-zone {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .upload-zone:hover, .upload-zone.dragover {
            border-color: #4a90d9;
            background: #f8fbff;
        }

        .upload-zone p {
            color: #999;
            margin-bottom: 10px;
        }

        .upload-zone input {
            display: none;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 24px;
            background: #4a90d9;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .btn svg {
            width: 16px;
            height: 16px;
        }

        .btn:hover {
            background: #3a7bc8;
        }

        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 144, 217, 0.4);
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-danger:focus {
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.4);
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 12px;
            min-height: 44px;
            min-width: 44px;
        }

        /* 文字输入 */
        .text-input {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .text-input:focus {
            outline: none;
            border-color: #4a90d9;
            box-shadow: 0 0 0 3px rgba(74, 144, 217, 0.2);
        }

        .hint {
            display: block;
            color: #999;
            font-size: 12px;
            margin-bottom: 12px;
        }

        /* 列表 */
        .list {
            list-style: none;
        }

        .list-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item .info {
            flex: 1;
            min-width: 0;
        }

        .list-item .name {
            color: #333;
            font-size: 14px;
            word-break: break-all;
        }

        .list-item .meta {
            color: #999;
            font-size: 12px;
            margin-top: 4px;
        }

        .list-item .actions {
            display: flex;
            gap: 8px;
            margin-left: 12px;
        }

        /* 文字卡片 */
        .text-item {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            position: relative;
        }

        .text-item:last-child {
            margin-bottom: 0;
        }

        .text-item .content {
            color: #333;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .text-item .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }

        .text-item .time {
            color: #999;
            font-size: 12px;
        }

        /* 空状态 */
        .empty {
            text-align: center;
            color: #999;
            padding: 40px 30px;
        }

        .empty svg {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            opacity: 0.4;
        }

        .empty p {
            margin: 0;
        }

        /* 进度条 */
        .progress {
            display: none;
            margin-top: 16px;
        }

        .progress-bar {
            height: 6px;
            background: #eee;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #4a90d9;
            width: 0%;
            transition: width 0.2s;
        }

        .progress-text {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            text-align: center;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .card {
                padding: 16px;
            }

            .upload-zone {
                padding: 30px 20px;
            }
        }

        /* Dark Mode */
        @media (prefers-color-scheme: dark) {
            body {
                background: #1a1a1a;
                color: #e5e5e5;
            }

            h1 svg {
                color: #5a9fe9;
            }

            .card {
                background: #2a2a2a;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            }

            .card h2 {
                color: #aaa;
            }

            .upload-zone {
                border-color: #444;
            }

            .upload-zone:hover, .upload-zone.dragover {
                border-color: #5a9fe9;
                background: #333;
            }

            .upload-zone p {
                color: #777;
            }

            .text-input {
                background: #333;
                border-color: #444;
                color: #e5e5e5;
            }

            .text-input:focus {
                border-color: #5a9fe9;
            }

            .text-input::placeholder {
                color: #666;
            }

            .list-item {
                border-bottom-color: #3a3a3a;
            }

            .list-item .name {
                color: #e5e5e5;
            }

            .list-item .meta {
                color: #777;
            }

            .text-item {
                background: #333;
            }

            .text-item .content {
                color: #e5e5e5;
            }

            .text-item .footer {
                border-top-color: #444;
            }

            .text-item .time {
                color: #777;
            }

            .empty {
                color: #666;
            }

            .hint {
                color: #666;
            }

            .badge {
                background: #444;
                color: #aaa;
            }

            .batch-bar {
                background: #2a3a4a;
            }

            .batch-bar span {
                color: #5a9fe9;
            }

            .progress-bar {
                background: #333;
            }

            .toast {
                background: #444;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z" />
            </svg>
            <span class="title-text">LANShare</span>
        </h1>

        <!-- 输入区域 -->
        <div class="grid-layout">
            <!-- 上传文件 -->
            <div class="card">
                <h2>上传文件</h2>
                <div class="upload-zone" id="uploadZone">
                    <p>点击或拖拽文件到这里上传</p>
                    <input type="file" id="fileInput" multiple>
                    <button class="btn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                        </svg>
                        选择文件
                    </button>
                </div>
                <div class="progress" id="progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">上传中...</div>
                </div>
            </div>

            <!-- 分享文字 -->
            <div class="card">
                <h2><label for="textInput">分享文字</label></h2>
                <textarea class="text-input" id="textInput" placeholder="粘贴或输入要分享的文字..." aria-describedby="textHint"></textarea>
                <small id="textHint" class="hint">按 Ctrl+Enter 快速发送</small>
                <button class="btn" onclick="addText()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                    </svg>
                    分享
                </button>
            </div>
        </div>

        <!-- 列表区域 -->
        <div class="grid-layout">
            <!-- 文件列表 -->
            <div class="card" id="fileCard">
                <h2>文件列表 <span class="badge" id="fileCount">{{ files|length }}</span></h2>
                <div class="batch-bar" id="batchBar">
                    <input type="checkbox" class="checkbox" id="selectAll" onchange="toggleSelectAll()">
                    <span><span id="selectedCount">0</span> 个已选</span>
                    <button class="btn btn-small btn-danger" onclick="batchDelete()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                        删除
                    </button>
                    <button class="btn btn-small" onclick="cancelSelect()">取消</button>
                </div>
            {% if files %}
            <ul class="list" id="fileList">
                {% for file in files %}
                <li class="list-item">
                    <input type="checkbox" class="checkbox file-checkbox" data-name="{{ file.name }}" onchange="updateSelection()">
                    <div class="info">
                        <div class="name">{{ file.name }}</div>
                        <div class="meta">{{ file.size }} · {{ file.time }}</div>
                    </div>
                    <div class="actions">
                        <a href="/download/{{ file.name }}" class="btn btn-small">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                            </svg>
                            下载
                        </a>
                        <button class="btn btn-small btn-danger" onclick="deleteFile('{{ file.name }}')">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                            </svg>
                            删除
                        </button>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="empty">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
                </svg>
                <p>暂无文件</p>
            </div>
            {% endif %}
            </div>

            <!-- 文字列表 -->
            <div class="card" id="textCard">
                <h2>分享的文字 <span class="badge" id="textCount">{{ texts|length }}</span></h2>
            {% if texts %}
            <div id="textList">
                {% for text in texts %}
                <div class="text-item" data-id="{{ text.id }}">
                    <div class="content">{{ text.content }}</div>
                    <div class="footer">
                        <span class="time">{{ text.time }}</span>
                        <div>
                            <button class="btn btn-small" onclick="copyText(this)">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9.75a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
                                </svg>
                                复制
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteText('{{ text.id }}')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                </svg>
                                删除
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" />
                </svg>
                <p>暂无分享的文字</p>
            </div>
            {% endif %}
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const progress = document.getElementById('progress');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');

        // 点击上传
        uploadZone.addEventListener('click', () => fileInput.click());

        // 文件选择
        fileInput.addEventListener('change', (e) => {
            uploadFiles(e.target.files);
        });

        // 拖拽上传
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            uploadFiles(e.dataTransfer.files);
        });

        // 上传文件
        function uploadFiles(files) {
            if (files.length === 0) return;

            let uploaded = 0;
            const total = files.length;
            const uploadedFiles = [];

            progress.style.display = 'block';

            Array.from(files).forEach(file => {
                const formData = new FormData();
                formData.append('file', file);

                const xhr = new XMLHttpRequest();

                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percent = Math.round((e.loaded / e.total) * 100);
                        progressFill.style.width = percent + '%';
                        progressText.textContent = `正在上传 ${file.name} (${percent}%)`;
                    }
                });

                xhr.addEventListener('load', () => {
                    uploaded++;
                    const res = JSON.parse(xhr.responseText);
                    if (res.success) {
                        uploadedFiles.push({
                            name: res.filename,
                            size: formatSize(file.size),
                            time: new Date().toLocaleString('zh-CN', { hour12: false }).replace(/\//g, '-')
                        });
                    }
                    if (uploaded === total) {
                        progress.style.display = 'none';
                        progressFill.style.width = '0%';
                        showToast('上传完成');
                        uploadedFiles.forEach(f => addFileToList(f));
                        fileInput.value = '';
                    }
                });

                xhr.addEventListener('error', () => {
                    showToast('上传失败');
                });

                xhr.open('POST', '/upload');
                xhr.send(formData);
            });
        }

        // 格式化文件大小
        function formatSize(size) {
            const units = ['B', 'KB', 'MB', 'GB'];
            let i = 0;
            while (size >= 1024 && i < units.length - 1) {
                size /= 1024;
                i++;
            }
            return size.toFixed(1) + ' ' + units[i];
        }

        // 添加文件到列表
        function addFileToList(file) {
            const fileCard = document.getElementById('fileCard');
            const emptyState = fileCard.querySelector('.empty');

            if (emptyState) {
                emptyState.remove();
                const ul = document.createElement('ul');
                ul.className = 'list';
                ul.id = 'fileList';
                fileCard.appendChild(ul);
            }

            const li = document.createElement('li');
            li.className = 'list-item';
            li.innerHTML = `
                <input type="checkbox" class="checkbox file-checkbox" data-name="${escapeHtml(file.name)}" onchange="updateSelection()">
                <div class="info">
                    <div class="name">${escapeHtml(file.name)}</div>
                    <div class="meta">${file.size} · ${file.time}</div>
                </div>
                <div class="actions">
                    <a href="/download/${encodeURIComponent(file.name)}" class="btn btn-small">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                        </svg>
                        下载
                    </a>
                    <button class="btn btn-small btn-danger" onclick="deleteFile('${escapeHtml(file.name)}')">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                        删除
                    </button>
                </div>
            `;

            const list = document.getElementById('fileList');
            list.insertBefore(li, list.firstChild);
            updateFileCount(1);
        }

        // 更新文件计数
        function updateFileCount(delta) {
            const badge = document.getElementById('fileCount');
            badge.textContent = parseInt(badge.textContent) + delta;
        }

        // 更新文字计数
        function updateTextCount(delta) {
            const badge = document.getElementById('textCount');
            badge.textContent = parseInt(badge.textContent) + delta;
        }

        // HTML 转义
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 删除文件
        function deleteFile(filename) {
            if (!confirm('确定删除该文件？')) return;

            fetch('/delete/' + encodeURIComponent(filename), { method: 'POST' })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        showToast('已删除');
                        const items = document.querySelectorAll('#fileList .list-item');
                        items.forEach(item => {
                            if (item.querySelector('.name').textContent === filename) {
                                item.remove();
                                updateFileCount(-1);
                            }
                        });
                        // 如果列表为空，显示空状态
                        const fileList = document.getElementById('fileList');
                        if (fileList && fileList.children.length === 0) {
                            fileList.remove();
                            const fileCard = document.getElementById('fileCard');
                            fileCard.innerHTML += `
                                <div class="empty">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
                                    </svg>
                                    <p>暂无文件</p>
                                </div>
                            `;
                        }
                    }
                });
        }

        // 添加文字
        function addText() {
            const textInput = document.getElementById('textInput');
            const content = textInput.value.trim();
            if (!content) {
                showToast('请输入内容');
                return;
            }

            fetch('/text', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    showToast('已分享');
                    textInput.value = '';
                    addTextToList(data.text);
                }
            });
        }

        // 添加文字到列表
        function addTextToList(text) {
            const textCard = document.getElementById('textCard');
            const emptyState = textCard.querySelector('.empty');

            if (emptyState) {
                emptyState.remove();
                const div = document.createElement('div');
                div.id = 'textList';
                textCard.appendChild(div);
            }

            const item = document.createElement('div');
            item.className = 'text-item';
            item.dataset.id = text.id;
            item.innerHTML = `
                <div class="content">${escapeHtml(text.content)}</div>
                <div class="footer">
                    <span class="time">${text.time}</span>
                    <div>
                        <button class="btn btn-small" onclick="copyText(this)">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9.75a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
                            </svg>
                            复制
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteText('${text.id}')">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                            </svg>
                            删除
                        </button>
                    </div>
                </div>
            `;

            const list = document.getElementById('textList');
            list.insertBefore(item, list.firstChild);
            updateTextCount(1);
        }

        // 删除文字
        function deleteText(id) {
            if (!confirm('确定删除该文字？')) return;

            fetch('/text/' + id, { method: 'DELETE' })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        showToast('已删除');
                        const item = document.querySelector(`.text-item[data-id="${id}"]`);
                        if (item) item.remove();
                        updateTextCount(-1);

                        // 如果列表为空，显示空状态
                        const textList = document.getElementById('textList');
                        if (textList && textList.children.length === 0) {
                            textList.remove();
                            const textCard = document.getElementById('textCard');
                            textCard.innerHTML += `
                                <div class="empty">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" />
                                    </svg>
                                    <p>暂无分享的文字</p>
                                </div>
                            `;
                        }
                    }
                });
        }

        // 复制文字
        function copyText(btn) {
            const content = btn.closest('.text-item').querySelector('.content').textContent;
            navigator.clipboard.writeText(content).then(() => {
                showToast('已复制到剪贴板');
            });
        }

        // Toast提示
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // Ctrl+Enter 发送文字
        document.getElementById('textInput').addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                addText();
            }
        });

        // 批量选择相关
        function updateSelection() {
            const checkboxes = document.querySelectorAll('.file-checkbox:checked');
            const count = checkboxes.length;
            document.getElementById('selectedCount').textContent = count;

            const batchBar = document.getElementById('batchBar');
            if (count > 0) {
                batchBar.classList.add('show');
            } else {
                batchBar.classList.remove('show');
            }

            // 更新全选状态
            const allCheckboxes = document.querySelectorAll('.file-checkbox');
            const selectAll = document.getElementById('selectAll');
            selectAll.checked = allCheckboxes.length > 0 && checkboxes.length === allCheckboxes.length;
        }

        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.file-checkbox');
            checkboxes.forEach(cb => cb.checked = selectAll.checked);
            updateSelection();
        }

        function cancelSelect() {
            document.querySelectorAll('.file-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('selectAll').checked = false;
            updateSelection();
        }

        function batchDelete() {
            const checkboxes = document.querySelectorAll('.file-checkbox:checked');
            const files = Array.from(checkboxes).map(cb => cb.dataset.name);

            if (files.length === 0) return;
            if (!confirm(`确定删除 ${files.length} 个文件？`)) return;

            fetch('/delete-batch', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ files })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    showToast(`已删除 ${data.deleted.length} 个文件`);
                    data.deleted.forEach(filename => {
                        const cb = document.querySelector(`.file-checkbox[data-name="${filename}"]`);
                        if (cb) cb.closest('.list-item').remove();
                    });
                    updateFileCount(-data.deleted.length);
                    cancelSelect();

                    // 如果列表为空，显示空状态
                    const fileList = document.getElementById('fileList');
                    if (fileList && fileList.children.length === 0) {
                        fileList.remove();
                        const fileCard = document.getElementById('fileCard');
                        fileCard.innerHTML += `
                            <div class="empty">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
                                </svg>
                                <p>暂无文件</p>
                            </div>
                        `;
                    }
                }
            });
        }
    </script>
</body>
</html>
